<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <title>学習結果</title>
  <style>
    body {
      font-family: "Helvetica Neue", Arial, sans-serif;
      padding: 30px;
      background: #f8f9fa;
      color: #333;
      line-height: 1.6;
    }
    h1 {
      text-align: center;
      margin-bottom: 30px;
      color: #007bff;
    }
    h2 {
      margin-top: 40px;
      color: #495057;
      border-left: 5px solid #007bff;
      padding-left: 10px;
    }
    .record {
      background: #fff;
      border: 1px solid #dee2e6;
      border-radius: 12px;
      padding: 20px;
      margin-bottom: 20px;
      box-shadow: 0 4px 6px rgba(0,0,0,0.05);
    }
    .record b {
      color: #212529;
    }
    .options {
      margin: 10px 0;
      padding-left: 20px;
    }
    .answer {
      padding: 8px 12px;
      border-radius: 6px;
      display: inline-block;
      margin: 5px 0;
    }
    .answer.correct {
      background: #d4edda;
      color: #155724;
      border: 1px solid #c3e6cb;
    }
    .answer.incorrect {
      background: #f8d7da;
      color: #721c24;
      border: 1px solid #f5c6cb;
    }
    .summary {
      background: #fff;
      border: 1px solid #dee2e6;
      border-radius: 12px;
      padding: 20px;
      margin-top: 30px;
      box-shadow: 0 4px 6px rgba(0,0,0,0.05);
    }
    button {
      display: block;
      margin: 30px auto;
      padding: 12px 24px;
      font-size: 16px;
      border: none;
      border-radius: 8px;
      background: #007bff;
      color: white;
      cursor: pointer;
      transition: background 0.3s;
    }
    button:hover {
      background: #0056b3;
    }
  </style>
</head>
<body>
  <h1>学習結果</h1>

  <h2>回答履歴</h2>
  {% for ev in evaluations %}
    <div class="record">
      <p><b>問題 {{ loop.index }}:</b> {{ ev.question_text }}</p>

      <ul class="options">
        {% for opt in ev.options %}
          <li>{{ opt.number }}. {{ opt.text }}</li>
        {% endfor %}
      </ul>

      {% if ev.chosen_answer is defined %}
        <p><b>あなたの解答:</b>
          <span class="answer {% if ev.result == '正解' %}correct{% else %}incorrect{% endif %}">
            {{ ev.chosen_answer.number }}. {{ ev.chosen_answer.text }}
          </span>
        </p>
      {% else %}
        <p><b>あなたの解答:</b> （記録なし）</p>
      {% endif %}
          {% if ev.correct_answer %}
      <p><b>正解:</b> {{ ev.correct_answer }}</p>   <!-- ★ 正解番号を表示 -->
    {% endif %}
      <p><b>結果:</b> {{ ev.result }}</p>
      <p><b>解説:</b> {{ ev.explanation }}</p>
    </div>
  {% endfor %}

  <h2>学習結果まとめ</h2>
{% if analysis %}
  <p><b>正答率:</b> {{ analysis["statistics"]["accuracy_rate"] }}</p>
  <p><b>総合評価:</b> {{ analysis["overall_evaluation"] }}</p>

  <h3>良い点</h3>
  <ul>
    {% for s in analysis["strengths"] %}
      <li>{{ s }}</li>
    {% endfor %}
  </ul>

  <h3>改善点</h3>
  <ul>
    {% for i in analysis["improvements"] %}
      <li>{{ i }}</li>
    {% endfor %}
  </ul>

  <h3>学習アドバイス</h3>
  <p>{{ analysis["advice"] }}</p>
{% endif %}


  <button onclick="location.href='/'">もう一度挑戦</button>
</body>
</html>
